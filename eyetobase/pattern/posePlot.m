% Auto-generated by cameraCalibrator app on 20-May-2023
%-------------------------------------------------------


% % % Define images to process
% % imageFileNames = {'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex4.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex8.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex12.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex19.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex20.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex21.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex23.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex24.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex26.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex29.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex35.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex37.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex43.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex44.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex47.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex49.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex50.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex59.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex60.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex63.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex64.png',...
% %     'C:\Users\Matthew\Desktop\TIM22_3D\data\sp-exp2\eyeInHand\多点\eyeinhand_rs_grid_1\image\ex74.png',...
% %     };
% % % Detect checkerboards in images
% % [imagePoints, boardSize, imagesUsed] = detectCheckerboardPoints(imageFileNames);
% % imageFileNames = imageFileNames(imagesUsed);
% % 
% % % Read the first image to obtain image size
% % originalImage = imread(imageFileNames{1});
% % [mrows, ncols, ~] = size(originalImage);
% % 
% % % Generate world coordinates of the corners of the squares
% % squareSize = 25;  % in units of 'millimeters'
% % worldPoints = generateCheckerboardPoints(boardSize, squareSize);

clc;clear;

filename='eyetobase_rvc_pattern';

currentFolder = pwd;
addpath ([currentFolder,'\functions\'])

for i=1:1e9
end
%%
num=50;
[Ri,ti,ppi,pattern] = preprocess2D(filename,num);

imagePoints=zeros(24,2,50);
for i=1:24
    for j=1:50
        imagePoints(i,:,j)=ppi(:,j,i);
    end
end

worldPoints=[];
for i=1:4
    for j=1:6
       worldPoints= [worldPoints;[(i-1)*30,(j-1)*30]];
    end
end
% Calibrate the camera
[cameraParams, imagesUsed, estimationErrors] = estimateCameraParameters(imagePoints, worldPoints, ...
    'EstimateSkew', false, 'EstimateTangentialDistortion', false, ...
    'NumRadialDistortionCoefficients', 2, 'WorldUnits', 'millimeters', ...
    'InitialIntrinsicMatrix', [], 'InitialRadialDistortion', [], ...
    'ImageSize', [720, 1280]);



showExtrinsics(cameraParams, 'CameraCentric');
% showExtrinsics(cameraParams, 'PatternCentric');
% Display parameter estimation errors
